<!DOCTYPE html>
<!-- QA dept. weekly report tool demo -->
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>일일리포트 작성지원도구</title>

  <!-- Babel (for JSX support in the browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React from "https://esm.sh/react@19"
    import ReactDOMClient from "https://esm.sh/react-dom@19/client"

    const { useState, useEffect, useId } = React;
    const REPORT_ITEMS_KEY = 'weekly-report-items';
    const BONGOCAT_KEY = 'bongocat-enabled';
    const NAME_KEY = 'add-name-field';
    const PROJECT_KEY = 'add-project-field';
    const DESC_KEY = 'add-desc-field';

    const names = ["박선우", "Soon to Depart Person"];
    const projectPreselect = ["Demo Project", "Other"];

    function App() {
      const [reportItems, setReportItems] = useState([]);

      // Load saved report items on initial page load
      useEffect(() => {
        const storedItems = localStorage.getItem(REPORT_ITEMS_KEY);
        if (storedItems) {
          try {
            setReportItems(JSON.parse(storedItems));
          } catch (e) {
            console.error('Failed to parse stored reportItems:', e);
          }
        } else {
          console.log("No stored items.");
        }
      }, []);

      // Save reported items on change
      useEffect(() => {
        localStorage.setItem(REPORT_ITEMS_KEY, JSON.stringify(reportItems));
      }, [reportItems]);

      return (
        <div className="max-w-4xl mx-auto px-8">
          <h1 className="text-3xl my-4">일일리포트 작성</h1>
          <Table
            reportItems={reportItems}
            setReportItems={setReportItems} />

          <h2 className="text-2xl mb-4">JSON Webex로 보내기</h2>
          <RawJSONView reportItems={reportItems} setReportItems={setReportItems} className="mb-4" />

          <h2 className="text-2xl mb-4">팀원 JSON 병합</h2>
          <TeamJSONMerge reportItems={reportItems} setReportItems={setReportItems} className="mb-4" />
        </div>
      );
    }

    // Define default components here
    function LabeledCheckbox({ children, ...props }) {
      const id = useId();

      return (
        <div className="flex flex-wrap items-center">
          <input
            className="transition-all accent-blue-500 w-4 h-4"
            id={id}
            type="checkbox"
            {...props}
          />
          <label className="ms-2" htmlFor={id}>{children}</label>
        </div>
      );
    }


    function TextArea({ ...props }) {
      return (
        <textarea
          className="font-mono w-full h-48 border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          {...props}
        />
      );
    }

    function Button({ type, children, className = '', ...props }) {
      const buttonColor = type === "danger" ? "red" : "blue";
      const disabled = props.disabled;

      return (
        <button
          className={`bg-${buttonColor}-500 text-white font-bold py-2 px-4 rounded hover:bg-${buttonColor}-600 ` +
            (disabled ? "opacity-50 cursor-not-allowed " : "") +
            className
          }
          {...props}
        >
          {children}
        </button>
      );
    }

    function Dropdown({ className = '', ...props }) {
      return (
        <select
          className={"border border-gray-300 rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500 " + className}
          {...props}
        />
      );
    }

    function TextBox({ className = '', ...props }) {
      return (
        <input
          className={"border border-gray-300 rounded-md py-2 px-4 focus:outline-none focus:ring-2 focus:ring-blue-500 " + className}
          {...props}
        />
      );
    }


    function RawJSONView({ reportItems, setReportItems, className = '' }) {
      const isEmpty = reportItems.length === 0;

      // Convert current state into JSON (for export)
      const jsonText = JSON.stringify(reportItems, null, 2);

      // Handle user JSON edits
      const handleJsonChange = (e) => {
        let text = e.target.value;
        if (text === "") { text = "[]" }
        try {
          const parsed = JSON.parse(text);
          setReportItems(parsed);
        } catch (err) {
          alert('입력한 JSON이 올바르지 않습니다. 다시 확인해 주세요.');
        }
      };

      const clipboardCopy = () => {
        navigator.clipboard.writeText(jsonText);
        alert("복사되었습니다. Webex로 전송해주세요.");
      };

      const resetAll = () => {
        if (typeof window !== 'undefined' && !confirm("초기화하시겠어요? 모든 아이템이 삭제됩니다!")) {
          return; // cancel
        }

        setReportItems([]);
      };

      const resetAllHelpText = isEmpty ?
        "초기화를 진행하려면 아이템이 존재해야 합니다." : "모든 아이템을 삭제합니다.";

      return (
        <div className={className}>
          <details>
            <summary className="mb-4 ms-8">펼치기</summary>
            <TextArea
              value={jsonText}
              onChange={handleJsonChange}
            />
          </details>
          <div className="flex flex-wrap justify-between gap-2">
            <Button onClick={clipboardCopy}>클립보드에 복사</Button>
            <Button type="danger" onClick={resetAll} disabled={isEmpty} title={resetAllHelpText}>초기화</Button>
          </div>
        </div>
      );
    }

    function TeamJSONMerge({ reportItems, setReportItems, className = '' }) {
      const [jsonText, setJsonText] = useState("");
      const [mergeHistory, setMergeHistory] = useState([]);

      const historyEmpty = mergeHistory.length === 0;
      const jsonTextEmpty = jsonText.length === 0;

      const startImport = (e) => {
        if (jsonTextEmpty) return;

        importWith(jsonText);
        // Clear JSON after adding
        setJsonText("");
      };

      const importWith = (text) => {
        // Store previous report items in merge history
        const previousItems = structuredClone(reportItems);
        setMergeHistory([...mergeHistory, previousItems]);
        try {
          const parsed = JSON.parse(text);

          parsed.forEach(user => {
            const { name, projects } = user;
            projects.forEach(project => {
              const { name: projectName, items } = project;
              items.forEach(description => {
                addNewItem(reportItems, setReportItems, name, projectName, description);
              });
            });
          });
        } catch (err) {
          alert('입력한 JSON이 올바르지 않습니다. 다시 확인해 주세요.');
        }
      }

      const undoHistory = () => {
        // Sanity check
        if (historyEmpty) return;

        if (typeof window !== 'undefined' && !confirm("마지막 병합 작업을 취소하시겠습니까?")) {
          return; // cancel
        }

        const newHistory = [...mergeHistory];
        setReportItems(newHistory.pop());
        setMergeHistory(newHistory);
      };

      const clipboardPaste = async () => {
        try {
          // Check if the Clipboard API is supported
          if (navigator.clipboard && navigator.clipboard.readText) {
            const text = await navigator.clipboard.readText();
            setJsonText(text);
            return text;
          } else {
            console.error("이 브라우저는 이 기능을 지원하지 않습니다.");
          }
        } catch (err) {
          alert("오류가 발생했습니다.");
          console.error("Failed to read clipboard contents:", err);
        }
      };

      const pasteAndImport = async () => {
        const text = await clipboardPaste();
        importWith(text);
        // Clear JSON after adding
        setJsonText("");
      }

      const handleKeyDown = (event) => {
        if (event.ctrlKey && event.key === "Enter") {
          event.preventDefault();
          startImport();
        } else if (event.ctrlKey && event.key === "z") {
          event.preventDefault();
          undoHistory();
        }
      };

      const undoHistoryHelpText = historyEmpty ?
        "현재 병합 내역이 비어있어 실행취소하실 수 없습니다." : "마지막 병합 작업을 실행취소하고 이전 단계로 되돌립니다.";
      const startImportHelpText = jsonTextEmpty ?
        "먼저 JSON을 입력해주세요." : "입력된 팀원의 JSON을 현재 JSON에 병합처리합니다.";

      return (
        <div className={className}>
          <details>
            <summary className="ms-8 mb-4">펼치기</summary>
            <TextArea
              value={jsonText}
              placeholder="팀원의 업무 내용을 한 분씩 여기에 붙여넣고, '병합' 버튼을 눌러주세요!"
              onChange={e => setJsonText(e.target.value)}
              onKeyDown={handleKeyDown}
            />
          </details>
          {/* Controls */}
          <div className="flex flex-wrap gap-2 justify-between">
            <Button onClick={clipboardPaste} className={"me-2"}>클립보드에서 붙여넣기</Button>
            <Button onClick={pasteAndImport} className={"me-2"}>붙여넣기 + 병합</Button>
            <div className="flex flex-wrap gap-2">
              <Button type="danger" onClick={undoHistory} disabled={historyEmpty} title={undoHistoryHelpText}>실행 취소</Button>
              <Button onClick={startImport} disabled={jsonTextEmpty} title={startImportHelpText}>병합</Button>
            </div>
          </div>
        </div>
      );
    }

    function addNewItem(reportItems, setReportItems, name, project, description) {
      if (!name || !project || !description) return;

      // Clean up whitespace
      var name = name.trim();
      var project = project.trim();
      var description = description.trim();

      setReportItems(prev => {
        const updated = [...prev];
        const personIndex = updated.findIndex(item => item.name === name);

        const newProject = {
          name: project,
          items: [description]
        };

        if (personIndex === -1) {
          // New person
          updated.push({
            name,
            projects: [newProject]
          });
        } else {
          // Existing person
          const existingProjectIndex = updated[personIndex].projects.findIndex(
            p => p.name === project
          );

          if (existingProjectIndex === -1) {
            // New project
            updated[personIndex].projects.push(newProject);
          } else {
            // Add to existing project
            updated[personIndex].projects[existingProjectIndex].items.push(description);
          }
        }
        return updated;
      });
    }

    function sortBySeniority(reportItems, shouldSortByTheSoonToDepart) {
      // Create a name -> index map for fast lookup
      const orderMap = names.reduce((acc, name, index) => {
        acc[name] = index;
        return acc;
      }, {});

      // Return a new sorted array
      return [...reportItems].sort((a, b) => {
        if (shouldSortByTheSoonToDepart) {
          if (a.name === names[1] && b.name !== names[1]) return -1;
          if (b.name === names[1] && a.name !== names[1]) return 1;
        }

        const indexA = orderMap[a.name] ?? Infinity;
        const indexB = orderMap[b.name] ?? Infinity;
        return indexA - indexB;
      });
    }

    function sortByProject(reportItems) {
      // Create a project -> index map for fast lookup
      const projectOrderMap = projectPreselect.reduce((acc, project, index) => {
        acc[project] = index;
        return acc;
      }, {});

      return reportItems.map(item => ({
        ...item,
        projects: [...item.projects].sort((a, b) => {
          const indexA = projectOrderMap[a.name] ?? Infinity;
          const indexB = projectOrderMap[b.name] ?? Infinity;
          return indexA - indexB;
        })
      }));
    }

    const BONGO_CAT_ACTIVATE = ["bongocat", "bongo cat"];
    const BONGO_CAT_DEACTIVATE = ["hidebongocat", "byebongocat", "hide bongocat", "bye bongocat", "hide bongo cat", "bye bongo cat"];

    function ReportForm({ reportItems, setReportItems, name, setName, project, setProject, description, setDescription, setShowBongoCat, className = '' }) {
      const isValid = name && project && description;

      const handleAdd = () => {
        if (!isValid) return;

        // Check for magic values or add new item
        if (BONGO_CAT_ACTIVATE.includes(project) || BONGO_CAT_ACTIVATE.includes(description)) {
          setShowBongoCat(true);
        } else if (BONGO_CAT_DEACTIVATE.includes(project) || BONGO_CAT_DEACTIVATE.includes(description)) {
          setShowBongoCat(false);
        } else {
          addNewItem(reportItems, setReportItems, name, project, description);
        }

        // Clear fields for next run
        setDescription('');
      }

      const handleEnter = (e) => {
        if (e.key !== "Enter") return;
        handleAdd();
      }

      const nameInNames = names.includes(name);
      const projectInPreselect = projectPreselect.includes(project);

      return (
        <div className={"flex flex-col flex-wrap gap-2 " + className}>
          <div className="flex flex-wrap items-baseline gap-2 justify-between">
            <div className="flex flex-wrap gap-2 items-baseline">
              <label className="font-bold" htmlFor="name-field">이름</label>
              <Dropdown
                value={name}
                onChange={e => setName(e.target.value)}
                id="name-field"
              >
                {names.map((name, index) => (
                  <option key={index} value={name}>
                    {name}
                  </option>
                ))}
                {!nameInNames && (
                  <option value={name}>{name}</option>
                )}
              </Dropdown>
            </div>

            <div className="flex flex-wrap gap-2 items-baseline">
              <label className="font-bold" htmlFor="project-field">프로젝트</label>
              <Dropdown
                value={project}
                onChange={e => setProject(e.target.value)}
                id="project-field"
              >
                {projectPreselect.map((projectPre, index) => (
                  <option key={index} value={projectPre}>
                    {projectPre}
                  </option>
                ))}
                {!projectInPreselect && (
                  <option value={project}>직접입력</option>
                )}
              </Dropdown>

              <TextBox
                placeholder="프로젝트"
                value={project}
                onChange={e => setProject(e.target.value)}
              />
            </div>
          </div>

          <div className="flex flex-wrap gap-2">
            <TextBox
              className="flex-grow"
              placeholder="업무 내용"
              value={description}
              onChange={e => setDescription(e.target.value)}
              onKeyPress={handleEnter}
              autofocus
            />
            <Button onClick={handleAdd} disabled={!isValid}>추가</Button>
          </div>
        </div>
      );
    }

    function removeItem(data, nameIndex, projectIndex, itemIndex) {
      return data
        .map((person, pIdx) => {
          if (pIdx !== nameIndex) return person;
          const updatedProjects = person.projects
            .map((project, projIdx) => {
              if (projIdx !== projectIndex) return project;
              const updatedItems = project.items.filter((_, iIdx) => iIdx !== itemIndex);
              if (updatedItems.length === 0) return null;
              return { ...project, items: updatedItems };
            })
            .filter(project => project !== null);
          if (updatedProjects.length === 0) return null;
          return { ...person, projects: updatedProjects };
        })
        .filter(person => person !== null);
    }

    function BongoCat() {
      const [leftPawActive, setLeftPawActive] = useState(true);
      const [keysPressed, setKeysPressed] = useState(new Set());

      useEffect(() => {
        const handleKeyDown = (e) => {
          // Prevent multiple toggles if key is held down
          if (e.repeat) return;

          // Add key pressed into set
          setKeysPressed(prev => new Set(prev.add(e.key)));

          // Switch paw being used
          setLeftPawActive((prev) => !prev);
        };
        const handleKeyUp = (e) => {
          // Remove key-up key from set
          setKeysPressed(prev => new Set([...prev].filter(x => x !== e.key)));
        };

        // If user leaves tab, key checks get messed up!
        const handleVisibilityChange = () => {
          if (document.visibilityState !== "visible") {
            console.log("Lost tab focus, unsetting all keys...");
            setKeysPressed(new Set());
          }
        };

        // Every 5 seconds, log pressed keys in the console if there are any
        const keyCheckInterval = setInterval(() => {
          if (keysPressed.size > 0) {
            console.log("Currently pressed keys: ", keysPressed);
          }
        }, 5000);

        window.addEventListener("keydown", handleKeyDown);
        window.addEventListener("keyup", handleKeyUp);
        window.addEventListener("visibilitychange", handleVisibilityChange);

        return () => {
          window.removeEventListener("keydown", handleKeyDown);
          window.removeEventListener("keyup", handleKeyUp);
          window.removeEventListener("visibilitychange", handleVisibilityChange);
          clearInterval(keyCheckInterval);
        };
      }, []);

      const leftPawDown = keysPressed.size > 0 && leftPawActive;
      const rightPawDown = keysPressed.size > 0 && !leftPawActive;

      /* SVG adapted from: https://codepen.io/carolineartz/pen/VwYwZaP */
      return (
        <div className="flex justify-end">
          <svg className="h-48 w-48 -my-16" id="bongo-cat" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 787.3 433.8">
            <defs>
              <symbol id="eye" data-name="eye" viewBox="0 0 19.2 18.7">
                <circle cx="9.4" cy="9.1" r="8"></circle>
                <path d="M16.3,5.1a1.3,1.3,0,0,1-1.4-.3,7.2,7.2,0,0,0-4.5-2.6A7.2,7.2,0,0,0,5.5,3.5,6.8,6.8,0,0,0,2.8,7.8a6.8,6.8,0,0,0,1,4.8,6.2,6.2,0,0,0,4,2.7,6.1,6.1,0,0,0,4.6-.7,6.7,6.7,0,0,0,2.9-3.7,6.4,6.4,0,0,0-.5-4.5c-.1-.2.8-1,1.5-1.3s2.2,0,2.3.5a9.4,9.4,0,0,1-.2,7.2,9.4,9.4,0,0,1-5.1,5.1,9,9,0,0,1-7,.2A9.6,9.6,0,0,1,1,13.5,9.2,9.2,0,0,1,.4,6.6,8.9,8.9,0,0,1,4.6,1.3,9,9,0,0,1,11.2.2,9.3,9.3,0,0,1,16.7,4C16.9,4.3,17,4.8,16.3,5.1Z"></path>
              </symbol>
              <symbol id="paw-pads" data-name="paw-pads" viewBox="0 0 31.4 33.9">
                <path d="M6.8,16a3.7,3.7,0,0,1,1.1,2.8,3.2,3.2,0,0,1-1.6,2.6L5,21.8H4.4a2.8,2.8,0,0,1-1.8.3A4.2,4.2,0,0,1,.2,19.1,7.7,7.7,0,0,1,0,17.6a2.8,2.8,0,0,1,.6-2,3.2,3.2,0,0,1,2.1-.8H4A5,5,0,0,1,6.8,16Zm7.3-4.8a1.8,1.8,0,0,0,.7-.5l.7-.4a3.5,3.5,0,0,0,1.1-1,3.2,3.2,0,0,0,.3-1.4,1.4,1.4,0,0,0-.2-.6,3.4,3.4,0,0,0-.3-2.4,3.2,3.2,0,0,0-2.1-1.5H13.1a4.7,4.7,0,0,0-1.6.4,2,2,0,0,0-.9.9l-.4.6v.4a6.1,6.1,0,0,0-.5,1.2,4.3,4.3,0,0,0,0,1.6,3.5,3.5,0,0,0,.5,2l.7.6a3.3,3.3,0,0,0,1.7.7A3,3,0,0,0,14.1,11.2ZM22.7,7l.6.2h.3A2.3,2.3,0,0,0,25,6.8l.4-.3.6-.3a7.5,7.5,0,0,0,1.5-.9,4.2,4.2,0,0,0,.8-1.2,1.9,1.9,0,0,0,.1-1.5A2.6,2.6,0,0,0,27.5,1,3.5,3.5,0,0,0,23.6.3a3.8,3.8,0,0,0-2,1.5,4.8,4.8,0,0,0-.7,2,3.6,3.6,0,0,0,.9,2.6ZM31,24.1a13.5,13.5,0,0,0-2.2-4.7,36.6,36.6,0,0,0-3.2-3.9,5.3,5.3,0,0,0-5-1.9,10.5,10.5,0,0,0-4.5,2.2A5.6,5.6,0,0,0,13.5,20a15.1,15.1,0,0,0,1.2,6.3c.8,2,1.7,4,2.6,5.9a1.6,1.6,0,0,0,1.5.8,1.7,1.7,0,0,0,1.9.9,17.1,17.1,0,0,0,8.7-4.8,8.2,8.2,0,0,0,1.7-2C31.6,26.3,31.3,25,31,24.1Z" fill="#ef97b0"></path>
              </symbol>
            </defs>
            <g id="head">
              <g id="head__outline">
                <path d="M303.2,186.3c4-7,14.8-20.2,20-26,17-19,34.6-34.9,43-41l12-8s16.6-32,21-33c9-2,33,22,33,22s20-9,79,7c41,11.1,47,14,57,22,7.5,6,18,16,18,16s33.7-19.5,41-15-2,66-2,66,5.9,12.9,11,22c9.1,16.2,13.6,20.2,19,31,3.6,7.2,8.4,28.5,10.5,43.5l-385-62Z" fill="#fff"></path>
                <path d="M302.9,186.9c-1.2,3-5.9,12.6-9,18.8l-12.5,25.5-.6-1.2c32.2,4.8,64.4,9.2,96.6,13.6s64.4,8.9,96.5,13.7,64.3,9.7,96.4,14.9,64.1,10.5,96.2,15.8l-5.6,5.5c-1.2-8.5-2.8-17.1-4.8-25.6-1-4.1-2.1-8.4-3.4-12.3l-.5-1.4-.5-1.4-.6-1.3-.7-1.3a59.5,59.5,0,0,0-3.1-5.5c-2.2-3.6-4.7-7.2-7.1-11s-4.8-7.6-7-11.5c-4.5-7.9-8.3-15.9-12.1-24a4,4,0,0,1-.3-2.6h0c1.4-9.1,2.7-18.2,3.7-27.4.5-4.5.9-9.1,1.2-13.7s.4-9.1.2-13.4a26.4,26.4,0,0,0-.8-6,8.1,8.1,0,0,0-.3-1.1c-.1-.3-.2-.4-.1-.3h.3c0,.1.1.1,0,.1h-.6a11.9,11.9,0,0,0-2.5.2,16.3,16.3,0,0,0-3,.7,56.7,56.7,0,0,0-6.2,2.1,212.6,212.6,0,0,0-24.5,11.9h-.1a3.9,3.9,0,0,1-4.7-.6c-4.9-4.7-10-9.4-15.1-13.8a86.6,86.6,0,0,0-7.9-6,46.1,46.1,0,0,0-8.5-4.6c-6-2.6-12.6-4.6-19.2-6.7l-19.8-5.7a324.9,324.9,0,0,0-40-8.9,196.8,196.8,0,0,0-20.2-1.8c-1.7,0-3.4-.1-5.1,0h-2.5l-2.5.2-2.5.2-2.4.4-2.4.5-1.1.3h-.5l-.4.2H433a2.5,2.5,0,0,1-2.6-.7c-4.6-4.6-9.5-9.1-14.5-13.2a82.7,82.7,0,0,0-7.9-5.7L403.9,81a10.8,10.8,0,0,0-4-.9c-.1,0-.3,0-.3.1h0l-.7.5-1.5,1.7c-1,1.2-2,2.6-2.9,3.9s-3.6,5.5-5.3,8.3c-3.5,5.7-6.8,11.4-9.9,17.3h0l-.4.4-10.2,6.6a53.6,53.6,0,0,0-4.9,3.4l-4.6,3.8c-6.2,5.1-12.1,10.6-17.9,16.2s-11.3,11.4-16.7,17.4c-2.7,3-5.3,6.1-7.8,9.2s-5,6.3-7.4,9.5c-4.2,5.6-7,10-5.7,7.1a34.1,34.1,0,0,1,2.1-3.8l3.8-5.6c2.9-4,6.3-8.3,8.5-10.9s4.4-5.2,6.7-7.7l6.9-7.4c4.7-4.9,9.4-9.7,14.3-14.3s9.8-9.3,15-13.7l4-3.2,4.2-2.9,8.3-5.7-.4.4c3-5.9,6.1-11.8,9.4-17.7,1.6-2.9,3.3-5.8,5.1-8.6l2.9-4.3,1.8-2a7.5,7.5,0,0,1,1.3-1.1c.1-.2.6-.4,1-.5l.9-.2h1.7l1.4.2,2.7.8c1.7.7,3.3,1.5,4.8,2.3a84,84,0,0,1,8.5,5.7A175.7,175.7,0,0,1,434,98.5l-2.9-.6.8-.3.7-.2L434,97l2.7-.7,2.7-.5a23,23,0,0,1,2.6-.3l2.7-.3,2.7-.2h5.3a182.1,182.1,0,0,1,21,1.3,332.5,332.5,0,0,1,41.1,8.4l20,5.5c6.7,2,13.4,4,20.1,6.7a65.3,65.3,0,0,1,9.8,5.1c3.1,2.1,5.9,4.3,8.6,6.5,5.4,4.5,10.6,9.2,15.7,14l-4.8-.6c4.1-2.4,8.2-4.6,12.4-6.7s8.6-4.2,13-6c2.3-.9,4.6-1.7,7-2.4a23.4,23.4,0,0,1,3.8-.9,20,20,0,0,1,4.4-.4h1.3l1.5.4a5.1,5.1,0,0,1,1.7.7l.9.7.8.7a8.3,8.3,0,0,1,1.6,2.6,12.7,12.7,0,0,1,.8,2.3,44.6,44.6,0,0,1,1.1,7.7c.2,5,.1,9.7-.1,14.4s-.7,9.5-1.2,14.1c-.9,9.4-2.1,18.6-3.6,27.9l-.3-2.6c3.7,7.9,7.5,15.8,11.8,23.3,2.1,3.7,4.4,7.4,6.8,11s4.9,7.2,7.3,11.1c1.3,2,2.4,4,3.5,6.1a10.9,10.9,0,0,0,.8,1.5l.8,1.8.7,1.7.6,1.7c1.5,4.4,2.6,8.7,3.7,13.1a262,262,0,0,1,5.2,26.4,4.9,4.9,0,0,1-4.1,5.6h-1.5c-32.1-5-64.2-9.9-96.3-15.1s-64.1-10.6-96.1-16.1-64-11.4-96-17.4-63.9-11.9-95.9-17.4h-.1a.8.8,0,0,1-.6-.9v-.2l16.6-32.1C299.8,192.2,304.1,183.9,302.9,186.9Z"></path>
              </g>
              <g id="head__face">
                <g id="eyes">
                  <use href="#eye" width="19.2" height="18.7" transform="translate(474.8 195.2)"></use>
                  <use href="#eye" width="19.2" height="18.7" transform="matrix(-0.51, -0.85, 0.82, -0.5, 370.39, 192.59)"></use>
                </g>
                <g id="mouth">
                  <path d="M399.2,186.3c.9,3.6,2.6,7.8,6,9,6.4,2.3,19-6,19-6s4.1,12.4,10,15,10.7-1.7,16-6" fill="#fff"></path>
                  <path d="M450.2,198.3c.6,1.2.2,1.9-.2,2.2a36.7,36.7,0,0,1-7.6,4.9,14.9,14.9,0,0,1-4.8,1.4h-1.4l-1.3-.2-1.4-.4-1.3-.6a21.6,21.6,0,0,1-6.4-7.2,52.8,52.8,0,0,1-4-8.3l3.8,1.3a62.3,62.3,0,0,1-7.1,4.1,32.1,32.1,0,0,1-7.9,2.8,13.2,13.2,0,0,1-4.9.2l-1.4-.3a7.5,7.5,0,0,1-1.3-.6,7.9,7.9,0,0,1-2.3-1.6,16.8,16.8,0,0,1-2.9-4,24.1,24.1,0,0,1-1.6-4.2c-.1-.5,1.6-1.3,3-1.4s3.5.2,3.6.6a10.3,10.3,0,0,0,2.6,4.9l.7.5h2.4l1.5-.2a28.4,28.4,0,0,0,6.5-2c2.1-1,4.3-2.1,6.3-3.3h.1a2.5,2.5,0,0,1,3.4.9l.3.5a43.1,43.1,0,0,0,3.2,7.7,19.8,19.8,0,0,0,2.2,3.4,8.1,8.1,0,0,0,2.6,2.6,5,5,0,0,0,3,.7,10.8,10.8,0,0,0,3.7-1,33.4,33.4,0,0,0,7.2-4.3C448.8,197.4,449.5,197.2,450.2,198.3Z"></path>
                </g>
              </g>
              <g id="paw-right">
                <g id="paw-right--down" className={!rightPawDown && "hidden"}>
                  <path d="M293.2,191.3l10-7s-18.4,11.1-24,20-13,20.4-9,31c4.7,12.4,20.5,15.7,22,16,20,3.8,47.8-24.3,47.8-24.3s1.9-3.3,2.2-3.7" fill="#fff"></path>
                  <path d="M342.1,223.4c.9,1.2.2,2.8-.3,3.7l-.4.7-.3.3a118.1,118.1,0,0,1-14.2,12.3,83.2,83.2,0,0,1-16.2,9.8,43.9,43.9,0,0,1-9.3,3,26.3,26.3,0,0,1-10.1.2,44.5,44.5,0,0,1-9.3-3.2,34.2,34.2,0,0,1-8.3-5.5,23,23,0,0,1-5.8-8.5,21.3,21.3,0,0,1-1.3-10.3,34.9,34.9,0,0,1,2.7-9.7,76.1,76.1,0,0,1,4.5-8.5l2.4-4,.6-1,.8-1.1a15.6,15.6,0,0,1,1.6-2,49.9,49.9,0,0,1,7-6.8,136.1,136.1,0,0,1,15.3-11.2,3.1,3.1,0,0,1,4.4,1,3,3,0,0,1-.8,4.2H305l-8.6,6.2c-.9.6-2.7-.5-3.1-1.9s.5-4.4,1.5-5l6.6-4.5,3.5,5.3A131.9,131.9,0,0,0,290,197.4a52.7,52.7,0,0,0-6.4,6,6.5,6.5,0,0,0-1.3,1.6l-.6.8-.7,1-2.4,3.8c-1.6,2.6-3.1,5.2-4.4,7.8a27.7,27.7,0,0,0-2.4,8.1,15.6,15.6,0,0,0,.8,8,17.4,17.4,0,0,0,4.4,6.7,27.2,27.2,0,0,0,7.1,4.9,39.5,39.5,0,0,0,8.1,3,21.6,21.6,0,0,0,8.4,0,37.8,37.8,0,0,0,8.5-2.6,84.9,84.9,0,0,0,15.7-9,142.4,142.4,0,0,0,14.1-11.6l-.3.3,1.1-1.8C340.3,223.4,341.3,222.2,342.1,223.4Z"></path>
                </g>
                <g id="paw-right--up" className={rightPawDown && "hidden"}>
                  <g>
                    <path d="M282.2,215.2c-1.6-1.6-12.8-17.9-14-34.3-.1-2.5,1.7-16,12.9-22.4s22.3-1.9,26.2.4c12.2,7.3,21.2,19.1,22.8,22.4" fill="#fff"></path>
                    <path d="M330,181.2a2.4,2.4,0,0,1-2.6-1.3,71.4,71.4,0,0,0-9.8-10.8,64,64,0,0,0-11.7-8.6,26.3,26.3,0,0,0-6.5-2.3,26.9,26.9,0,0,0-6.9-.6,24.9,24.9,0,0,0-6.7,1.3,20.8,20.8,0,0,0-5.8,3.3,23.1,23.1,0,0,0-7.6,11,32.5,32.5,0,0,0-1.4,6.6,6.6,6.6,0,0,0,.1,1.4l.2,1.8c.1,1.2.4,2.3.6,3.5a65,65,0,0,0,4.8,13.4c1,2.2,2.2,4.3,3.4,6.4a43.1,43.1,0,0,0,3.9,5.9.6.6,0,0,1,0,.6c0,.2-.2.4-.4.7a5.7,5.7,0,0,1-1.5,1.6c-1.3.6-4.1.1-4.6-.6a89.5,89.5,0,0,1-7.2-13.7,63.7,63.7,0,0,1-4.3-14.9,25.7,25.7,0,0,1-.5-4c0-.3-.1-.6-.1-1v-1.2a12.5,12.5,0,0,1,.2-2.1,35.2,35.2,0,0,1,2.4-7.8,28.6,28.6,0,0,1,4.1-6.9,24.6,24.6,0,0,1,6.1-5.5,26.2,26.2,0,0,1,15.5-4.2,28.9,28.9,0,0,1,7.8,1.2l3.8,1.3,1.8.9,1.8,1a78.2,78.2,0,0,1,11.9,9.6,80.2,80.2,0,0,1,9.7,11.8C331.1,179.7,331.4,181,330,181.2Z"></path>
                  </g>
                  <use href="#paw-pads" width="31.4" height="33.93" transform="translate(273.2 166.1) rotate(-5.6)"></use>
                </g>
              </g>
            </g>
            <g id="paw-left">
              <g id="paw-left--up" className={leftPawDown && "hidden"}>
                <g>
                  <path d="M545.4,261.9c-7.1-13-12.9-31.1-13.3-37.6-.6-9,0-15.6,5.2-22.2s15-9.8,22.7-8.8a26.7,26.7,0,0,1,17.3,9.4c5.3,5.8,9.4,12.9,11.6,16.6" fill="#fff"></path>
                  <path d="M588.9,219.2c-1.4.4-2.3-.7-2.8-1.4a93.9,93.9,0,0,0-8.9-12.5c-3.3-3.9-7.1-7-11.7-8.6a24.2,24.2,0,0,0-7.1-1.4,24.5,24.5,0,0,0-7.1.7,27,27,0,0,0-6.6,2.7,21,21,0,0,0-5.2,4.6,20.6,20.6,0,0,0-3.5,6.1,22.2,22.2,0,0,0-1.3,6.9,47.3,47.3,0,0,0,.1,7.5,52.2,52.2,0,0,0,1.4,7.1c1.4,4.8,3.1,9.7,5,14.4a147.7,147.7,0,0,0,6.5,13.9c.4.7-1,2.3-2.4,2.6s-4-.6-4.4-1.4c-2.3-4.8-4.3-9.7-6.1-14.6a128.8,128.8,0,0,1-4.6-15.3c-.3-1.3-.5-2.6-.7-4a16.4,16.4,0,0,1-.2-2.2v-2a57,57,0,0,1,.4-8.2,27.2,27.2,0,0,1,2.3-8.2c.7-1.3,1.4-2.5,2.2-3.7l1.3-1.7,1.4-1.6a28.8,28.8,0,0,1,7-5,27.6,27.6,0,0,1,8-2.5,25.6,25.6,0,0,1,8.3-.2,27.4,27.4,0,0,1,15.1,6.7,50.6,50.6,0,0,1,5.5,5.9,111.3,111.3,0,0,1,8.7,13.2C589.8,217.7,590.3,218.9,588.9,219.2Z"></path>
                </g>
                <use href="#paw-pads" width="31.4" height="33.93" transform="matrix(0.99, -0.03, 0.04, 1, 539.85, 203.52)"></use>
              </g>
              <g id="paw-left--down" className={!leftPawDown && "hidden"}>
                <path d="M538.2,239.3c-3.2,1.6-33,10.8-37,28-.4,1.8-2.1,18.9,7,26,5.5,4.3,12.7,2.8,25,0,10.3-2.3,19-5.8,40-16,9.1-4.4,16.6-8.2,22-11" fill="#fff"></path>
                <path d="M595.1,266.4c.1,1.4-1.4,2.4-2.4,2.9l-18.3,9.4c-6.2,3.1-12.3,6.1-18.6,9a120.8,120.8,0,0,1-19.6,7.2l-5.1,1.2-5.1,1.1a43.4,43.4,0,0,1-5.2.9,33.8,33.8,0,0,1-5.6.3,17.8,17.8,0,0,1-5.8-1.5,6.1,6.1,0,0,1-1.4-.7l-1.3-.9-2.2-2a23.6,23.6,0,0,1-5.2-10.2,44.5,44.5,0,0,1-1.3-10.9c0-.9.1-1.8.1-2.7a6.6,6.6,0,0,0,.1-1.4v-.7c.1-.3.1-.7.2-.9a21.6,21.6,0,0,1,2.1-5.5,33.4,33.4,0,0,1,7.1-8.7,67.1,67.1,0,0,1,8.7-6.4,121.7,121.7,0,0,1,19-9,1.5,1.5,0,0,1,1.7.6,3.4,3.4,0,0,1,.9,1.9c.1,1.5-1.6,4.2-2.6,4.6a91.1,91.1,0,0,0-17.8,8.5,40.1,40.1,0,0,0-7.6,5.8,22.8,22.8,0,0,0-5.2,7.3l-.4,1-.3,1a1.7,1.7,0,0,0-.2.5v.4c-.1.4-.1.8-.2,1.2s-.1,3.1-.1,4.7a35.4,35.4,0,0,0,1.4,9.3,15.6,15.6,0,0,0,4.5,7.3c2,1.9,4.7,2.6,7.8,2.5a55.9,55.9,0,0,0,9.7-1.2l4.9-1.1,4.9-1.1a121,121,0,0,0,18.8-6.8c12.4-5.3,24.6-11.5,36.8-17.4C593.4,265.4,595,264.9,595.1,266.4Z"></path>
              </g>
            </g>
          </svg>
        </div>
      );
    }

    function Table({ reportItems, setReportItems }) {
      const [futurePlansMode, setFuturePlansMode] = useState(false);
      const headingText = futurePlansMode ? "차주" : "금일";

      const [sortName, setSortName] = useState(true);
      const [sortProject, setSortProject] = useState(true);
      const [showBongoCat, setShowBongoCat] = useState(false);

      const [name, setName] = useState(names[0]);
      const [project, setProject] = useState(projectPreselect[0]);
      const [description, setDescription] = useState('');

      // Load bongocat state and saved fields in add form on initial page load
      useEffect(() => {
        const bongoCatEnabled = localStorage.getItem(BONGOCAT_KEY);
        if (bongoCatEnabled && bongoCatEnabled === "true") {
          setShowBongoCat(true);
        }

        const storedName = localStorage.getItem(NAME_KEY);
        if (storedName) {
          setName(storedName);
        }

        const storedProject = localStorage.getItem(PROJECT_KEY);
        if (storedProject) {
          setProject(storedProject);
        }

        const storedDesc = localStorage.getItem(DESC_KEY);
        if (storedDesc) {
          setDescription(storedDesc);
        }
      }, []);

      // Save fields on change
      useEffect(() => {
        localStorage.setItem(NAME_KEY, name);
      }, [name]);

      useEffect(() => {
        localStorage.setItem(PROJECT_KEY, project);
      }, [project]);

      useEffect(() => {
        localStorage.setItem(DESC_KEY, description);
      }, [description]);

      useEffect(() => {
        localStorage.setItem(BONGOCAT_KEY, showBongoCat);
      }, [showBongoCat]);

      var sortedItems = reportItems;

      if (sortProject) sortedItems = sortByProject(sortedItems);
      if (sortName) sortedItems = sortBySeniority(sortedItems, name === names[1]);

      const copyItem = (item) => {
        navigator.clipboard.writeText(item);
      };

      const deleteItem = (person_idx, project_idx, job_idx) => {
        if (typeof window !== 'undefined' && !confirm("정말로 삭제하시겠어요? 선택하신 아이템은 다시 필드로 이동시킵니다.")) {
          return; // cancel
        }

        const targetPerson = sortedItems[person_idx];
        const targetProject = targetPerson["projects"][project_idx];
        const targetDescription = targetProject["items"][job_idx];

        setReportItems(removeItem(sortedItems, person_idx, project_idx, job_idx));

        setName(targetPerson["name"]);
        setProject(targetProject["name"]);
        setDescription(targetDescription);
      };

      return (
        <div>
          <div id="report-table">
            <div id="table-options" className="mb-4">
              <LabeledCheckbox
                checked={futurePlansMode}
                onChange={e => setFuturePlansMode(e.target.checked)}
              >
                차주 보고서 헤더
              </LabeledCheckbox>
              <LabeledCheckbox
                checked={sortName}
                onChange={e => setSortName(e.target.checked)}
              >
                이름 정렬
              </LabeledCheckbox>

              <LabeledCheckbox
                checked={sortProject}
                onChange={e => setSortProject(e.target.checked)}
              >
                프로젝트 정렬
              </LabeledCheckbox>
            </div>

            <table border="1" className="w-full border-collapse border border-black">
              <thead>
                <tr>
                  <th className="text-center border border-black p-2">이름</th>
                  <th className="text-center border border-black p-2">프로젝트</th>
                  <th className="text-center border border-black p-2">{headingText} 업무 내용</th>
                </tr>
              </thead>
              <tbody>
                {sortedItems.length === 0 ? (
                  <tr>
                    <td colSpan="3" className="text-center border border-black p-2">
                      아이템이 없습니다. 아래에서 추가하세요!
                    </td>
                  </tr>
                ) : (
                  sortedItems.map((person, person_idx) =>
                    person.projects.map((project, project_idx) => (
                      <tr key={person.name + project.name}>
                        {project_idx === 0 && (
                          <td className="border border-black p-2 cursor-pointer hover:text-gray-700"
                            rowSpan={person.projects.length}
                            onClick={e => { setName(person.name) }}
                          >{person.name}</td>
                        )}
                        <td className="border border-black p-2 cursor-pointer hover:text-gray-700"
                          onClick={e => { setProject(project.name) }}>{project.name}</td>
                        <td className="border border-black p-2">
                          <ul>
                            {project.items.map((item, job_idx) => (
                              <li
                                className="list-disc ms-5 cursor-pointer hover:text-gray-700"
                                key={job_idx}
                                onContextMenu={e => { copyItem(item) }}
                                onClick={e => { deleteItem(person_idx, project_idx, job_idx) }}
                              >
                                {item}
                              </li>
                            ))}
                          </ul>
                        </td>
                      </tr>
                    ))
                  )
                )}
              </tbody>
            </table>
          </div>
          <div>
            <span className="block mb-4">(팁: 아이템을 누르면 삭제하실 수 있고, 삭제된 아이템은 바로 편집할 수 있도록 필드에 다시 입력됩니다.)</span>

            {showBongoCat && <BongoCat />}

            <ReportForm
              className="mb-4"
              reportItems={reportItems}
              setReportItems={setReportItems}
              name={name}
              setName={setName}
              project={project}
              setProject={setProject}
              description={description}
              setDescription={setDescription}
              setShowBongoCat={setShowBongoCat}
            />
          </div>
        </div>
      );
    }

    const rootElement = document.getElementById('root');
    const root = ReactDOMClient.createRoot(rootElement);
    root.render(<App />);
  </script>
</body>

</html>